<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">

<!--
A webcomponent written with Polymer to list Twitch and (in future) Youtube streams. You will be able to filter the results by a specific game and define priority for a selected language.

Example:

    <streaming-list lang="pt" game="Dota 2"></streaming-list>

@demo demo/index.html
@hero hero.svg
-->

<dom-module id="streaming-list">
  <template>
    <style>
      :host {
        display: block;
        box-sizing: border-box;
      }
    </style>
    <iron-ajax
               id="ajax"
               auto
               url="{{apiUrl}}"
               handle-as="json"
               last-response="{{response}}"
               debounce-duration="300"
               params='{{_concatParams(limit, lang, game)}}'></iron-ajax>
    <template is="dom-repeat" items="[[response.streams]]">
      <div>[[item.channel.display_name]]</div>
    </template>
  </template>

  <script>
    Polymer({
      is: "streaming-list",

      /**
       * Fired when a request is sent.
       *
       * @event request
       */

      /**
       * Fired when a response is received.
       *
       * @event response
       */

      /**
       * Fired when an error is received.
       *
       * @event error
       */

      properties: {
        /**
         * `apiUrl` indicates the URL of twitch API to list streams
         */
        apiUrl: {
          type: String,
          value: "https://api.twitch.tv/kraken/streams"
        },

        /**
         * `limit` Used to define the number of itens in the list
         */
        limit: {
          type: Number,
          value: 5
        },

        /**
         * `lang` Used to filter the language of the videos
         */
        lang: {
          type: String,
          value: "en"
        },

        /**
         * `game` Used to filter videos from a specific game
         */
        game: {
          type: String,
          default: null
        },

        /**
        * `response` The data retrieved from the server
        */
        response: {
          type: Object,
          value: {streams: []},
          notify: true
        }
      },

      listeners: {
        'ajax.request': '_onRequest',
        'ajax.response': '_onResponse',
        'ajax.error': '_onError'
      },

      _concatParams: function(limit, lang, game) {
        return JSON.stringfy({limit: limit, language: lang, game: game});
      },

      _onRequest: function(event) {
        this.fire('request', event);
      },

      _onResponse: function(event) {
        this.fire('response', event);
      },

      _onError: function(event) {
        this.fire('error', event);
      },

      /**
       * Performs an AJAX request to the streaming server
       * @returns {!IronRequestElement} Returns !IronRequestElement
       */
      generateRequest() {
        return this.$.ajax.generateRequest();
      }
    });
  </script>
</dom-module>
